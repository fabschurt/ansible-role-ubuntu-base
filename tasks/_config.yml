---
- name: Upload NTP config file
  tags: [config]
  template:
    src: etc/ntp.conf
    dest: /etc/ntp.conf
    mode: 0644
  notify: fabschurt.ubuntu.base.ntp_config_loaded

- name: Upload Postfix config files
  tags: [config]
  template:
    src: '{{ item }}'
    dest: '/{{ item }}'
    mode: 0644
  with_items:
    - etc/mailname
    - etc/postfix/main.cf
  notify: fabschurt.ubuntu.base.postfix_config_loaded

- name: Redirect postmaster and root e-mails to custom address
  tags: [config]
  template:
    src: etc/aliases
    dest: /etc/aliases
    mode: 0644
  notify: fabschurt.ubuntu.base.aliases_added

- name: Upload miscellaneous config files
  tags: [config]
  copy:
    src: '{{ item }}'
    dest: '/{{ item }}'
    mode: 0644
  with_items:
    - etc/ssh/
    - etc/pam.d/
    - etc/profile
    - etc/bash.bashrc
    - etc/login.defs
    - etc/adduser.conf
    - etc/deluser.conf

- name: Register needed locales
  tags: [config]
  lineinfile:
    regexp: '^#\s*{{ item|regex_escape }}(\s+[A-Za-z\d\-]+)?$'
    backrefs: true
    line: '{{ item }}\1'
    state: present
    dest: /etc/locale.gen
    create: true
  with_items: '{{ ubuntu_base_needed_locales + ubuntu_base_additional_needed_locales }}'
  notify: fabschurt.ubuntu.base.locales_added

---
- name: Upload custom config files
  tags: [config]
  copy:
    src: '{{ item }}'
    dest: '/{{ item }}'
    mode: 0644
  with_items:
    - etc/ssh/
    - etc/pam.d/
    - etc/profile
    - etc/bash.bashrc
    - etc/login.defs
    - etc/adduser.conf
    - etc/deluser.conf

- name: Upload custom config templates
  tags: [config]
  template:
    src: '{{ item }}'
    dest: '/{{ item }}'
    mode: 0644
  with_items:
    - etc/ntp.conf
    - etc/mailname
    - etc/postfix/main.cf
    - etc/aliases
  notify:
    - Restart NTP
    - Restart Postfix
    - Register new aliases

- name: Register needed locales
  tags: [config]
  lineinfile:
    regexp: '^#\s*{{ item|regex_escape }}(\s+[A-Za-z\d\-]+)?$'
    backrefs: true
    line: '{{ item }}\1'
    state: present
    dest: /etc/locale.gen
  with_items: '{{ ubuntu_base_needed_locales }}'
  notify:
    - Generate locales
